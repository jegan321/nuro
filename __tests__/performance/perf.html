<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Nuro</title>
    <script src="../../build/nuro.js"></script>
  </head>
  <body>
    <div id="app">
        <h1>{{ title.trim().toUpperCase() }}</h1>
        <main $if="loaded">
            <h2>Loaded {{n}} users</h2>
            <div $for="user in users" data-userid="{{ getUserId(user) }}">
                <h3>{{user.name.first}} {{user.name.last}} ({{getUserId(user)}})</h3>
                <h4>Product Information</h4>
                <ul>
                    <li $for="p in user.products" id="{{p.id}}">
                        <span class="pid">{{p.id}}</span>
                        <strong class="name">{{p.name}}</strong>
                        <span class="price">
                            {{ formatPrice(p) }}
                        </span>
                        <span $if="p.onSale" class="sale">***</span>
                    </li>
                </ul>
            </div>
        </main>
        <div $if="!loaded">
            <h2>{{loadingMsg}}</h2>
            <button type="button" onclick="load()">Load Users</button>
        </div>
    </div>

    <script>
        var start = performance.now()
        var app = Nuro.create({
            root: '#app',
            data: {
                loaded: false,
                title: 'Performance Test',
                loadingMsg: 'Data is not loaded',
                getUserId: (user) => {
                    return user.name.last.toLowerCase() + user.name.first[0].toLowerCase()
                },
                formatPrice: (product) => {
                    var price = product.onSale ? product.salePrice : product.price               
                    return '$' + price.toFixed(2)
                }
            }
        })
        var took = performance.now() - start
        console.log('Created app in ' + took + ' millis')

        function load() {
            var users = []
            var user = {
                name: { first: 'John', last: 'Smith' },
                products: [
                {
                    id: 85663,
                    name: 'Black and Silver Coffee Pot',
                    price: 25.99,
                    onSale: true,
                    salePrice: 20.99
                    },
                    {
                    id: 16662,
                    name: 'White Tooth Brush',
                    price: 2.50,
                    onSale: false
                    },
                    {
                    id: 909001,
                    name: 'Electric Guitar and Amplifier Combo',
                    price: 299
                    },
                    {
                    id: 1726381,
                    name: 'Samsung Smart TV 50 Inch',
                    price: 699,
                    salePrice: 599,
                    onSale: true
                    },
                    {
                    id: 986456,
                    name: 'Macbook Pro, Silver',
                    price: 2099
                    }
                ]
            }
            var n = 1000
            for (var i=0; i<n; i++) { users.push(user) }
            var updateStart = performance.now()
            app.update({
                loaded: true,
                users: users,
                n
            })
            var updateTook = performance.now() - updateStart
            console.log('Updated in ' + updateTook + ' millis');
        }
        
    </script>
    
  </body>
</html>