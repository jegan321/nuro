!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Nuro=e()}(this,(function(){"use strict";function t(t){return"[object Object]"===Object.prototype.toString.call(t)}function e(t){return Array.isArray(t)}function n(t){return function(n,r={},o=[]){let s,i,c;e(o)||(o=[o]),"function"==typeof n?(s="component",i="",c=n):t.has(n)?(s="component",i="",c=t.get(n)):(s="element",i=n);let l={nodeType:s,tag:i,text:"",attrs:r,children:[],componentClass:c};return l.children=o.map((t=>function(t){return null!=t&&void 0!==t.nodeType}(t)?t:{nodeType:"text",tag:"",text:t,attrs:{},children:[]})),l}}class r extends Error{constructor(t){super(t)}}class o{constructor(t){this.domPatcher=t}reconcile(t,e,n){let o=this.createPatchFunction(e,n)(t);if(o)return o;throw new r("Patch function did not return an element")}createPatchFunction(t,e){return this.diffNodes(t,e)}diffNodes(t,e){if(!e)return t=>this.domPatcher.removeNode(t);if(!("text"!==t.nodeType&&"text"!==e.nodeType||e.text===t.text&&"text"===t.nodeType&&"text"===e.nodeType))return t=>this.domPatcher.replaceNode(t,e);if("component"===e.nodeType){if(t.componentClass!==e.componentClass)return n=>this.domPatcher.mountComponentOnNode(n,t,e);{const t=e.attrs;return t.children=e.children,e=>this.domPatcher.setComponentPropsOnNode(e,t)}}if(t.tag!==e.tag)return n=>("component"===t.nodeType&&this.domPatcher.unmountComponentOnNode(n),this.domPatcher.replaceNode(n,e));let n=this.diffAttributes(t.attrs,e.attrs);const r=this.diffChildren(t.children,e.children);return t=>(n(t),r(t),t)}diffAttributes(t,e){let n=[];for(const[t,r]of Object.entries(e))n.push((e=>(this.domPatcher.setAttribute(e,t,r),e)));for(const r in t)r in e&&null!=e[r]||n.push((t=>(this.domPatcher.removeAttribute(t,r),t)));return t=>{for(const e of n)e(t);return t}}diffChildren(t=[],e=[]){const n=[];t.forEach(((t,r)=>{n.push(this.diffNodes(t,e[r]))}));const o=[];for(const n of e.slice(t.length))o.push((t=>this.domPatcher.appendChildNode(t,n)));return t=>{if(n.length!==t.childNodes.length)throw new r("Actual child nodes in DOM does not match number of child patches");let e=function(t,e){const n=[];for(let r=0;r<Math.max(t.length,e.length);r++){let o={left:t[r],right:e[r]};n.push(o)}return n}(n,t.childNodes);for(const t of e){(0,t.left)(t.right)}for(const e of o)e(t);return t}}}function s(t,e=!0){return i(t,e)}function i(t,e){if(1===t.nodeType){let n={nodeType:"element",tag:t.tagName.toLowerCase(),text:"",attrs:{},children:[]};return Array.prototype.forEach.call(t.attributes,(t=>{n.attrs[t.name]=t.value})),n.children=function(t,e){let n=[];return Array.prototype.forEach.call(t,(t=>{if(e||8!==t.nodeType){let r=i(t,e);n.push(r)}})),n}(t.childNodes,e),n}return{nodeType:8===t.nodeType?"comment":"text",text:t.textContent||"",tag:"",attrs:{},children:[]}}function c(t){return t._nuro||(t._nuro={eventHandlers:{}}),t._nuro}function l(t){let e=c(t);if(e.component)return e.component;throw new r("Element does not have component inside context object")}function u(t){return null!=t._nuro&&null!=t._nuro.component}const a={get:function(n,r){let o=n[r];return(t(o)||e(o))&&("props"!==r||n.$component)?r.startsWith("$")?o:(o.$component=d(n),e(o)&&o.forEach((e=>{t(e)&&(e.$component=d(n))})),new Proxy(o,a)):o},set:function(t,e,n){t[e]=n;let r=d(t);"props"===e&&(r.$vnode.attrs=n);return r.$update(),!0},deleteProperty:function(t,e){return delete t[e],d(t).$update(),!0}};function d(t){return null!=t.$component?t.$component:t}function p(t,e){t[e]&&t[e]()}const f=new Map;function h(t){let e=f.get(t);if(e)return e;var n;let r="with(this){return "+m(s((n=t,(new DOMParser).parseFromString(n,"text/html").body.children[0]),!1))+"}";return f.set(t,r),r}function m(t){if("text"===t.nodeType){let e=t.text.replace(/\n/g,"\\n");return e=g(e),e}return void 0!==t.attrs.$if?function(t){let e=t.attrs.$if;return delete t.attrs.$if,`(${e})?${$(t)}:''`}(t):void 0!==t.attrs.$for?function(t){let e=t.attrs.$for;delete t.attrs.$for;let n=e.trim().split(" in "),r=n[0];return`...${n[1]}.map((${r})=>${m(t)})`}(t):"slot"===t.tag?"...props.children":$(t)}function $(t){let e="h(";e+="'"+t.tag+"'";let n=new Map;for(let[e,r]of Object.entries(t.attrs))e.startsWith("$")||(e.startsWith(":")?e=e.substr(1):e.startsWith("@")||(r=g(r)),n.set(e,r));if(t.attrs.$class){let e=n.has("class")?n.get("class"):"''",r=`Object.entries(${t.attrs.$class}).reduce((prevC,c)=>c[1]?prevC+=" "+c[0]:prevC,${e}).trim()`;n.set("class",r)}if(t.attrs.$bind){const e=t.tag,r=t.attrs.type;let o;"input"===e&&"checkbox"===r?o={prop:"checked",event:"change"}:"input"===e||"textarea"===e?o={prop:"value",event:"input"}:"select"===e&&(o={prop:"value",event:"change"}),o&&(n.set(o.prop,t.attrs.$bind),n.set("@"+o.event,`(e)=>{this.$update({${t.attrs.$bind}:e.target.${o.prop}})}`))}let r="{"+Array.from(n).map((([t,e])=>`'${t}':${e}`)).join(",")+"}";if(t.attrs.$attrs){let e=r,n=t.attrs.$attrs;r=`{...${e},...${n},...{class:(${e}.class?(${e}.class+' '+(${n}.class||'')).trim():${n}.class)}}`}if(e+=","+r,t.children.length>0){let n=[];t.children.forEach((t=>{if("text"===t.nodeType&&""===t.text.trim())return;let e=m(t);n.push(e)})),e+=",["+n.join(",")+"]"}return e+=")",e}function g(t){if(t.length<5)return"'"+t+"'";let e,n,r=!1,o="",s="";"{"===t.charAt(0)&&"{"===t.charAt(1)||(s+="'");for(let i=0;i<t.length;i++)e=t.charAt(i),n=t.length>i&&t.charAt(i+1),"{"===e&&n&&"{"===n?(0!==i&&(s+="'+"),s+="(",i++,r=!0):"}"===e?(i++,s+=o+")",r=!1,o="",i!==t.length-1&&(s+="+'")):r?o+=e:s+=e;return"'"!==e&&"}"!==e&&(s+="'"),s}function y(t){return t.split("").map(((t,e)=>{return 1===(n=t).length&&n.toLowerCase()!=n.toUpperCase()&&t===t.toUpperCase()?0===e?t.toLowerCase():"-"+t.toLowerCase():t;var n})).join("")}const v=new Map;const b=[];let C=new class{constructor(t,e,n){this.mountComponent=t,this.unmountComponent=e,this.setProps=n}removeNode(t){t.remove()}replaceNode(t,e){let n=this.createNode(e);return this.unmountComponent(t),t.replaceWith(n),n}appendChildNode(t,e){return t.appendChild(this.createNode(e)),t}mountComponentOnNode(t,e,n){if(n.componentClass)return this.unmountComponent(t),this.mountComponent(n.componentClass,t,n.attrs,n.children,e);throw new r("Component class is required for component node type")}setComponentPropsOnNode(t,e){return this.setProps(t,e)}unmountComponentOnNode(t){this.unmountComponent(t)}createNode(t,e=!1){let n;if(e=e||"svg"===t.tag,"component"===t.nodeType){if(!t.componentClass)throw new r("Component class is required for component node type");{let e=document.createElement("div"),r=s(e);n=this.mountComponent(t.componentClass,e,t.attrs,t.children,r)}}else n="text"===t.nodeType?document.createTextNode(t.text):e?document.createElementNS("http://www.w3.org/2000/svg",t.tag):document.createElement(t.tag);if("component"!==t.nodeType){for(let[e,r]of Object.entries(t.attrs))this.setAttribute(n,e,r);t.children.forEach((t=>{let r=this.createNode(t,e);n.appendChild(r)}))}return n}setAttribute(t,e,n){if("checked"===e){t.checked=!!n}if(null!=n)if(e.startsWith("@")){if(o=n,"[object Function]"!==Object.prototype.toString.call(o))throw new r("Event handler must be a function");!function(t,e,n){let r=c(t),o=r.eventHandlers[e];o?o!==n&&(t.removeEventListener(e,o),t.addEventListener(e,n),r.eventHandlers[e]=n):(t.addEventListener(e,n),r.eventHandlers[e]=n)}(t,e.substring(1),n)}else t.getAttribute(e)!==n&&t.setAttribute(e,n);var o}removeAttribute(t,e){e.startsWith("@")?function(t,e){let n=c(t);t.removeEventListener(e,n.eventHandlers[e]),delete n.eventHandlers[e]}(t,e.substring(1)):t.removeAttribute(e)}createElementInBody(t){let e=document.createElement(t);return document.body.appendChild(e),e}}(w,x,(function(t,e){return l(t).props=e,t}));function w(e,n,o,s,i){let l=new e(o);p(l,"beforeInit"),function(t){b.forEach((e=>{Object.keys(e).forEach((n=>{t[n]=e[n]}))}))}(l);let u=l.includes||{};if(l.includes=function(t,e){let n=new Map([...e]);for(let e in t){let r=t[e],o=y(e);n.set(e,r),n.set(o,r)}return n}(u,v),!l.render){if(!l.template)throw new r("Either a render method or a template string is required in a component class");{let t=h(l.template);l.render=new Function("h",t)}}l.$element=n,l.$vnode=i,l.props=o,l.props.children=s;let d=function(t){return new Proxy(t,a)}(l);return l.$update=function(e){e&&t(e)&&Object.assign(l,e),E(l)},function(t,e,n){(r=n,Object.getOwnPropertyNames(r.prototype).filter((t=>"constructor"!==t))).forEach((n=>{t[n]=t[n].bind(e)}));var r}(l,d,e),p(d,"beforeMount"),E(l),p(d,"afterMount"),function(t,e){c(t).component=e}(l.$element,d),l.$element}function x(t){if(null!=t&&u(t)){return N(l(t).$element,"beforeUnmount"),delete t._nuro,!0}return!1}function N(t,e){if(Array.from(t.children).forEach((t=>{N(t,e)})),u(t)){p(l(t),e)}}function E(t){p(t,"beforeRender");let e=n(t.includes),s=t.render(e);if(!s.nodeType)throw new r("Component render method did not return VNode");let i=new o(C).reconcile(t.$element,t.$vnode,s);return p(t,"afterRender"),t.$vnode=s,t.$element=i,t}const T=[];return{mount:function(t,e,n={}){return e||(e=C.createElementInBody("div")),l(w(t,e,n,[],s(e)))},unmount:x,compileTemplate:h,include:function(t,e){v.set(y(t),e)},mixin:function(t){b.push(t)},install:function(t,e){T.includes(t)||(t.install(this,e),T.push(t))}}}));
